<policies>
  <inbound>
    <base />
    <choose>
      <when condition="@(context.Request.Headers.GetValueOrDefault(&quot;Authorization&quot;,&quot;&quot;).StartsWith(&quot;Bearer &quot;))">
        <validate-jwt header-name="Authorization" failed-validation-httpcode="401" failed-validation-error-message="Unauthorized: Invalid or missing JWT token">
          <openid-config url="{{OPENID_CONFIG_URL}}" />
          <audiences>
            <audience>{{JWT_AUDIENCE}}</audience>
          </audiences>
          <issuers>
            <issuer>{{JWT_ISSUER}}</issuer>
          </issuers>
        </validate-jwt>
      </when>
      <otherwise>
        <check-header name="Ocp-Apim-Subscription-Key" failed-check-httpcode="401" failed-check-error-message="Unauthorized: Missing or invalid subscription key" />
      </otherwise>
    </choose>
  </inbound>
  <backend>
    <base />
  </backend>
  <outbound>
    <base />
  </outbound>
  <on-error>
    <base />
  </on-error>
</policies>